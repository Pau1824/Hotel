<div class="max-w-6xl mx-auto flex flex-col gap-6 px-4 sm:px-6 lg:px-0">

  <!-- ================= ENCABEZADO ================= -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h1 class="text-2xl font-semibold text-slate-900">Usuarios del hotel</h1>
      <p class="text-sm text-slate-500">
        Solo se muestran usuarios del hotel actual.
      </p>
    </div>

    <!-- BOTÓN NUEVO USUARIO -->
    <button
      class="w-full md:w-auto px-4 py-2 rounded-lg text-sm font-medium bg-sky-600 text-white hover:bg-sky-700 transition shadow-sm"
      (click)="abrirNuevoUsuario()">
      + Nuevo usuario
    </button>
  </div>

  <!-- ================= MODAL EDITAR ================= -->
  <ng-container *ngIf="editarVisible">
    <div class="fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4">
      <div class="bg-white rounded-2xl shadow-xl w-full max-w-xl sm:max-w-2xl p-5 sm:p-6">

        <h2 class="text-lg font-semibold text-slate-800 mb-4">
          Editar usuario recepcionista
        </h2>

        <!-- GRID RESPONSIVE -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

          <!-- Usuario -->
          <div class="col-span-1 sm:col-span-2">
            <label class="block text-xs font-medium text-slate-500 mb-1">Usuario *</label>
            <input
              type="text"
              class="input-field"
              [(ngModel)]="editarUsuario.usuario"
              name="usuarioEditar"
            />
          </div>

          <!-- Nombre -->
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">Nombre(s) *</label>
            <input
              type="text"
              class="input-field"
              [(ngModel)]="editarUsuario.nombre"
            />
          </div>

          <!-- Apellidos -->
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">Apellidos *</label>
            <input
              type="text"
              class="input-field"
              [(ngModel)]="editarUsuario.apellido"
            />
          </div>

          <!-- Teléfono -->
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">Teléfono</label>
            <input
              type="tel"
              class="input-field"
              [(ngModel)]="editarUsuario.telefono"
              maxlength="10"
              inputmode="numeric"
            />
          </div>

          <!-- Correo -->
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">Correo</label>
            <input
              type="email"
              class="input-field"
              [(ngModel)]="editarUsuario.correo"
            />
          </div>

          <!-- Nueva pass -->
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">Nueva contraseña</label>
            <input
              type="password"
              class="input-field"
              [(ngModel)]="editarUsuario.nuevaContrasena"
            />
            <p class="text-[11px] text-slate-400 mt-1">Déjalo vacío si no quieres cambiarla.</p>
          </div>

          <!-- Repetir pass -->
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">Repetir contraseña</label>
            <input
              type="password"
              class="input-field"
              [(ngModel)]="editarUsuario.repetirContrasena"
            />
          </div>

        </div>

        <!-- BOTONES -->
        <div class="mt-6 flex justify-end gap-3">
          <button
            class="btn-secondary"
            (click)="cancelarEditarUsuario()"
            [disabled]="guardandoEdicion">
            Cancelar
          </button>

          <button
            class="btn-primary"
            (click)="guardarEdicionUsuario()"
            [disabled]="guardandoEdicion">
            {{ guardandoEdicion ? 'Guardando…' : 'Guardar cambios' }}
          </button>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- ================= FILTROS ================= -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">

    <!-- Chips -->
    <div class="inline-flex rounded-full bg-slate-100 p-1 self-start">
      <button
        class="chip-btn"
        [ngClass]="{ 'chip-btn-active': estadoFiltro === 'activo' }"
        (click)="setEstadoFiltro('activo')">
        Activo
      </button>
      <button
        class="chip-btn"
        [ngClass]="{ 'chip-btn-active': estadoFiltro === 'inactivo' }"
        (click)="setEstadoFiltro('inactivo')">
        Inactivo
      </button>
    </div>

    <!-- Buscador -->
    <div class="w-full sm:w-72">
      <div class="relative">
        <span class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-[18px]">
          search
        </span>
        <input
          type="text"
          class="w-full pl-9 pr-3 py-2 rounded-lg border border-slate-200 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500/70"
          placeholder="Buscar usuarios..."
          [(ngModel)]="search"
        />
      </div>
    </div>
  </div>

  <!-- ================= FORM NUEVO USUARIO ================= -->
  <div *ngIf="nuevoVisible" class="bg-white border border-slate-200 rounded-xl p-4 sm:p-5 shadow-sm">
    <h2 class="text-lg font-semibold text-slate-800 mb-4">Nuevo usuario recepcionista</h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

      <!-- Usuario -->
      <div>
        <label class="input-label">Usuario *</label>
        <input class="input-field" [(ngModel)]="nuevoUsuario.usuario" />
      </div>

      <!-- Teléfono -->
      <div>
        <label class="input-label">Teléfono</label>
        <input class="input-field" [(ngModel)]="nuevoUsuario.telefono" maxlength="10" />
      </div>

      <!-- Nombre -->
      <div>
        <label class="input-label">Nombre(s) *</label>
        <input class="input-field" [(ngModel)]="nuevoUsuario.nombre" />
      </div>

      <!-- Apellido -->
      <div>
        <label class="input-label">Apellidos *</label>
        <input class="input-field" [(ngModel)]="nuevoUsuario.apellido" />
      </div>

      <!-- Correo -->
      <div>
        <label class="input-label">Correo</label>
        <input class="input-field" [(ngModel)]="nuevoUsuario.correo" />
      </div>

      <!-- Rol -->
      <div>
        <label class="input-label">Rol</label>
        <div class="inline-flex px-3 py-1 rounded-full bg-sky-50 text-sky-700 text-xs font-medium">
          Recepcionista
        </div>
      </div>

      <!-- Pass -->
      <div>
        <label class="input-label">Contraseña *</label>
        <input type="password" class="input-field" [(ngModel)]="nuevoUsuario.contrasena" />
      </div>

      <!-- Repetir Pass -->
      <div>
        <label class="input-label">Repetir contraseña *</label>
        <input type="password" class="input-field" [(ngModel)]="nuevoUsuario.repetirContrasena" />
      </div>
    </div>

    <!-- BOTONES -->
    <div class="mt-4 flex justify-end gap-3">
      <button class="btn-secondary" (click)="cancelarNuevoUsuario()">Cancelar</button>
      <button class="btn-primary" [disabled]="guardando" (click)="guardarNuevoUsuario()">
        {{ guardando ? 'Guardando…' : 'Guardar usuario' }}
      </button>
    </div>
  </div>

  <!-- ================= TABLA ================= -->
  <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-x-auto">
    <table class="w-full min-w-[700px] text-sm">
      <thead class="bg-slate-50 border-b border-slate-200">
        <tr class="text-left text-slate-500">
          <th class="px-4 py-3">Usuario</th>
          <th class="px-4 py-3">Nombre completo</th>
          <th class="px-4 py-3">Teléfono</th>
          <th class="px-4 py-3">Rol</th>
          <th class="px-4 py-3">Estado</th>
          <th class="px-4 py-3">Último acceso</th>
          <th class="px-4 py-3 text-right">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngIf="usuariosFiltrados().length === 0">
          <td colspan="7" class="px-4 py-8 text-center text-slate-400">
            No se encontraron usuarios.
          </td>
        </tr>

        <tr *ngFor="let u of usuariosFiltrados()" class="border-b border-slate-100 hover:bg-slate-50 transition">
          <td class="px-4 py-3">{{ u.usuario }}</td>
          <td class="px-4 py-3">{{ u.nombreCompleto }}</td>
          <td class="px-4 py-3">{{ u.telefono || '—' }}</td>
          <td class="px-4 py-3">
            <span class="badge-sky">{{ u.rolTexto }}</span>
          </td>
          <td class="px-4 py-3">
            <span [ngClass]="u.estado === 'activo' ? 'badge-green' : 'badge-gray'">
              {{ u.estado | titlecase }}
            </span>
          </td>
          <td class="px-4 py-3">{{ u.ultimoAcceso ? (u.ultimoAcceso | date:'yyyy-MM-dd HH:mm') : '—' }}</td>
          <td class="px-6 py-4 text-right space-x-4">
            <button class="text-slate-600 hover:text-sky-600" (click)="abrirEditarUsuario(u)">
              Editar
            </button>

            <button
              class="font-medium"
              [ngClass]="u.estado === 'activo'
                ? 'text-red-600 hover:text-red-700'
                : 'text-sky-600 hover:text-sky-700'"
              (click)="u.estado === 'activo' ? desactivar(u) : activar(u)">
              {{ u.estado === 'activo' ? 'Desactivar' : 'Activar' }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ESTILOS UTILES -->
<style>
  .input-label { @apply block text-xs font-medium text-slate-500 mb-1; }
  .input-field { @apply w-full border rounded-lg px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-500; }
  .btn-primary { @apply px-4 py-2 rounded-lg text-sm bg-sky-600 text-white hover:bg-sky-700 shadow-sm; }
  .btn-secondary { @apply px-4 py-2 rounded-lg text-sm border border-slate-300 text-slate-700 hover:bg-slate-50; }
  .badge-green { @apply inline-flex items-center px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-[11px] font-medium; }
  .badge-gray { @apply inline-flex items-center px-3 py-1 rounded-full bg-slate-100 text-slate-600 text-[11px] font-medium; }
  .badge-sky { @apply inline-flex items-center px-3 py-1 rounded-full bg-sky-50 text-sky-700 text-[11px] font-medium; }
  .chip-btn { @apply px-4 py-1.5 rounded-full text-sm font-medium text-slate-600; }
  .chip-btn-active { @apply bg-white shadow-sm text-sky-600; }
</style>

